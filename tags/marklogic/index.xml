<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
      <title>marklogic on Roy Tang</title>
      <link>https://roytang.net/tags/marklogic/</link>
      <description>Recent content in marklogic on Roy Tang</description>
      <generator>Hugo -- gohugo.io</generator>
      <language>en-us</language>
      <managingEditor>hello@roytang.net (Roy Tang)</managingEditor>
      <webMaster>hello@roytang.net (Roy Tang)</webMaster>
      <lastBuildDate>Thu, 28 Dec 2017 17:04:03 +0000</lastBuildDate>
      
          <atom:link href="https://roytang.net/tags/marklogic/index.xml" rel="self" type="application/rss+xml" />
      
          
      
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/12/48011448/</link>
            <pubDate>Thu, 28 Dec 2017 17:04:03 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/12/48011448/</guid>
            <description>
            

            &lt;p&gt;I have a query using MarkLogic node.js that basically boils down to something like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;db.documents.query(qb.where(qb.collection(&#39;test&#39;))).stream()
.on(&#39;data&#39;, function(row) {
    console.log(&amp;quot;Stream on data&amp;quot;);
})
.on(&#39;end&#39;, function() {
    console.log(&amp;quot;Stream on end&amp;quot;);
})
.on(&#39;error&#39;, function(error) {
    console.log(error);
})
;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now, for a certain collection we have in our database, the &amp;lsquo;end&amp;rsquo; function doesn&amp;rsquo;t fire, i.e. I never see &amp;ldquo;Stream on end&amp;rdquo; appear in the log. There&amp;rsquo;s no error or anything, processing just stops. It&amp;rsquo;s only for this particular collection, other collections seem fine.&lt;/p&gt;
&lt;p&gt;If I query documents in that collection directly using other methods such as qb.value() without using qb.collection(), the end event fires correctly. But once I add qb.collection() into the mix (using qb.and), the end event doesn&amp;rsquo;t fire.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m unsure how to debug this, as this is my first time trying to use streams in the nodejs client library. Any advice as to what I can check?&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/12/47880549/</link>
            <pubDate>Tue, 19 Dec 2017 05:31:56 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/12/47880549/</guid>
            <description>
            

            &lt;p&gt;How to specify that a column in the schema should be nullable?&lt;/p&gt;
&lt;p&gt;I tried adding a nullable attribute:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;var myFirstTDE = xdmp.toJSON(
  {
    &amp;quot;template&amp;quot;: {
      &amp;quot;context&amp;quot;: &amp;quot;/match&amp;quot;,
      &amp;quot;collections&amp;quot;: [&amp;quot;source1&amp;quot;],
      &amp;quot;rows&amp;quot;: [
        {
          &amp;quot;schemaName&amp;quot;: &amp;quot;soccer&amp;quot;,
          &amp;quot;viewName&amp;quot;: &amp;quot;matches&amp;quot;,
          &amp;quot;columns&amp;quot;: [
            {
              &amp;quot;name&amp;quot;: &amp;quot;id&amp;quot;,
              &amp;quot;scalarType&amp;quot;: &amp;quot;long&amp;quot;,
              &amp;quot;val&amp;quot;: &amp;quot;id&amp;quot;,
              &amp;quot;nullable&amp;quot;: 0
            },
            {
              &amp;quot;name&amp;quot;: &amp;quot;document&amp;quot;,
              &amp;quot;scalarType&amp;quot;: &amp;quot;string&amp;quot;,
              &amp;quot;val&amp;quot;: &amp;quot;docUri&amp;quot;
            },
            {
              &amp;quot;name&amp;quot;: &amp;quot;date&amp;quot;,
              &amp;quot;scalarType&amp;quot;: &amp;quot;date&amp;quot;,
              &amp;quot;val&amp;quot;: &amp;quot;match-date&amp;quot;
            },
            {
              &amp;quot;name&amp;quot;: &amp;quot;league&amp;quot;,
              &amp;quot;scalarType&amp;quot;: &amp;quot;string&amp;quot;,
              &amp;quot;val&amp;quot;: &amp;quot;league&amp;quot;
            }
          ]
        }
      ]
    }
  }
);

tde.validate( 
  [myFirstTDE]
);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But this gave me a template error:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;quot;message&amp;quot;: &amp;quot;TDE-INVALIDTEMPLATENODE: Invalid extraction template node: fn:doc(&#39;&#39;)/template/array-node(&#39;rows&#39;)/object-node()/array-node(&#39;columns&#39;)/object-node()[1]/number-node(&#39;nullable&#39;)&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For a template defined using XQuery, adding nullable to the column works:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;column&amp;gt;
  &amp;lt;name&amp;gt;ISSN&amp;lt;/name&amp;gt;
  &amp;lt;scalar-type&amp;gt;string&amp;lt;/scalar-type&amp;gt;
  &amp;lt;val&amp;gt;Journal/ISSN&amp;lt;/val&amp;gt;
  &amp;lt;nullable&amp;gt;true&amp;lt;/nullable&amp;gt;
&amp;lt;/column&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How to do the same thing using JS/Json?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/11/47513579/</link>
            <pubDate>Mon, 27 Nov 2017 14:42:48 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/11/47513579/</guid>
            <description>
            

            &lt;p&gt;This is a follow-up to my question here: &lt;a href=&#34;https://stackoverflow.com/questions/47449002/marklogic-template-driven-extraction-and-triples-dealing-with-array-nodes/47459250#47459250&#34;&gt;https://stackoverflow.com/questions/47449002/marklogic-template-driven-extraction-and-triples-dealing-with-array-nodes/47459250#47459250&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So let&amp;rsquo;s say I have a number of documents structured like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;declareUpdate();

xdmp.documentInsert(
       &#39;/test/tde.json&#39;,
       {
         content: {
           name:&#39;Joe Parent&#39;,
           children: [
             {
               name: &#39;Bob Child&#39;
             },
             {
               name: &#39;Sue Child&#39;
             },
             {
               name: &#39;Guy Child&#39;
             }
           ]
         }
       },
       {permissions : xdmp.defaultPermissions(),
        collections : [&#39;test&#39;]})
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I want to define a template that would extract triples from these documents defining sibling relationships between the children. For the above example, I would want to extract the following triples (the relationship is two-way):&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Bob Child sibling-of Sue Child
Bob Child sibling-of Guy Child
Sue Child sibling-of Bob Child
Sue Child sibling-of Guy Child
Guy Child sibling-of Bob Child
Guy Child sibling-of Sue Child
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How can i set up my template to accomplish this?&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/11/47449002/</link>
            <pubDate>Thu, 23 Nov 2017 06:32:35 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/11/47449002/</guid>
            <description>
            

            &lt;p&gt;I&amp;rsquo;ve been studying the examples here: &lt;a href=&#34;https://docs.marklogic.com/guide/semantics/tde#id_25531&#34;&gt;https://docs.marklogic.com/guide/semantics/tde#id_25531&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I have a set of documents that are structured with a parent name and an array of children nodes with their own names. I want to create a template that generates triples of the form &amp;ldquo;name1 is-a-parent-of name2&amp;rdquo;. Here&amp;rsquo;s a test I tried, with a sample of the document structure:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;declareUpdate();

xdmp.documentInsert(
       &#39;/test/tde.json&#39;,
       {
         content: {
           name:&#39;Joe Parent&#39;,
           children: [
             {
               name: &#39;Bob Child&#39;
             },
             {
               name: &#39;Sue Child&#39;
             }
           ]
         }
       },
       {permissions : xdmp.defaultPermissions(),
        collections : [&#39;test&#39;]})

cts.doc(&#39;/test/tde.json&#39;)

var tde = require(&amp;quot;/MarkLogic/tde.xqy&amp;quot;);
// Load the user template for user profile rows
var template = xdmp.toJSON(
{
  &amp;quot;template&amp;quot;:{
    &amp;quot;context&amp;quot;:&amp;quot;content&amp;quot;,
    &amp;quot;collections&amp;quot;: [
      &amp;quot;test&amp;quot;
    ],
      &amp;quot;triples&amp;quot;:[
      {
        &amp;quot;subject&amp;quot;: {
          &amp;quot;val&amp;quot;: &amp;quot;xs:string(name)&amp;quot;
        },
        &amp;quot;predicate&amp;quot;: {
          &amp;quot;val&amp;quot;: &amp;quot;sem:iri(&#39;is-parent-of&#39;)&amp;quot;
        },
        &amp;quot;object&amp;quot;: {
          &amp;quot;val&amp;quot;: &amp;quot;xs:string(children/name)&amp;quot;
        }     
      }
    ]   
  }
}
);
//tde.validate([template]),
tde.templateInsert(&amp;quot;/templates/test.tde&amp;quot;, template);
tde.nodeDataExtract( 
  [cts.doc( &#39;/test/tde.json&#39; )]
)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, the above throws an Exception:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[javascript] TDE-EVALFAILED: tde.nodeDataExtract([cts.doc(&amp;quot;/test/tde.json&amp;rdquo;)]) &amp;ndash; Eval for Object=&#39;xs:string(children/name)&amp;rsquo; returns TDE-BADVALEXPRESSION: Invalid val expression: XDMP-CAST: (err:FORG0001) Invalid cast: (fn:doc(&amp;quot;/test/tde.json&amp;rdquo;)/content/array-node(&amp;ldquo;children&amp;rdquo;)/object-node()[1]/text(&amp;ldquo;name&amp;rdquo;), fn:doc(&amp;quot;/test/tde.json&amp;rdquo;)/content/array-node(&amp;ldquo;children&amp;rdquo;)/object-node()[2]/text(&amp;ldquo;name&amp;rdquo;)) cast as xs:string?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;What is the proper syntax for extracting array nodes into a triple?&lt;/p&gt;
&lt;p&gt;2nd somewhat related question: say I also wanted to have triples of the form &amp;ldquo;child1 is-sibling-of child2&amp;rdquo;. For the example above it would be &amp;ldquo;Bob Child is-sibling-of Sue Child&amp;rdquo;. What would be the proper syntax for this? I&amp;rsquo;m not even sure how to begin with this one.&lt;/p&gt;
&lt;p&gt;Is TDE even the way to go here? Or is it better to do this programmatically? i.e. on document ingestion, generate those triples inside the document directly?&lt;/p&gt;
&lt;p&gt;(If it&amp;rsquo;s relevant, the ML version being used is 9.)&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/11/47336545/</link>
            <pubDate>Thu, 16 Nov 2017 18:15:35 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/11/47336545/</guid>
            <description>
            

            &lt;p&gt;I&amp;rsquo;ve been testing migrating one of our systems to Marklogic 9 and using the Optics API.&lt;/p&gt;
&lt;p&gt;One of our functions involves grouping claims by member_id, member_name and getting the sums and counts, so I did something like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;var results = op.fromView(&#39;test&#39;, &#39;claims&#39;)
  .groupBy([&#39;member_id&#39;, &#39;member_name&#39;], [
         op.count(&#39;num_claims&#39;, &#39;claim_no&#39;),
         op.sum(&#39;total_amount&#39;, &#39;claim_amount&#39;)
         ])
  .orderBy(op.desc(&#39;total_amount&#39;))
  .limit(200)
  .result()
  .toArray();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Above works fine. The results are of the form&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[
  { 
    member_id: 1, 
    member_name: &#39;Bob&#39;, 
    num_claims: 10, 
    total_amount: 500
  }, 
  ...
]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, we also have a field &amp;ldquo;company&amp;rdquo;, where each claim is filed under a different company. Basically the relevant view columns are claim_no, member_id, member_name, company, claim_amount&lt;/p&gt;
&lt;p&gt;I would like to be able to show a column that list the different companies for which the member_id/member_name has filed claims, and how many claims for each company.&lt;/p&gt;
&lt;p&gt;i.e. I want my results to be something like:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[
  { 
    member_id: 1, 
    member_name: &#39;Bob&#39;, 
    num_claims: 10, 
    total_amount: 500,
    companies: [
      {
        company: &#39;Ajax Co&#39;,
        num_claims: 8
      },
      {
        company: &#39;Side Gig&#39;,
        num_claims: 2
      }
    ]
  }, 
  ...
]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I tried something like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;results = results.map((member, index, array) =&amp;gt; {
  var companies = op.fromView(&#39;test&#39;, &#39;claims&#39;)
    .where(op.eq(op.col(&#39;member_id&#39;), member.member_id))
    .groupBy(&#39;company&#39;, [
      op.count(&#39;num_claims&#39;, &#39;claim_no&#39;)      
    ])
    .result()
    .toArray();
  member.companies = companies;
  return member;
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And the output seems correct, but it also executes quite slowly - almost a minute (total number of claim documents is around 120k)&lt;/p&gt;
&lt;p&gt;In our previous ML8 implementation, we were pre-generating summary documents for each member - so retrieval was reasonably fast with the downside that whenever we got a bunch of new data, all of the summary documents had to be re-generated. I was hoping that ML9&amp;rsquo;s optic API would make it easier to do the retrieval/grouping/aggregates on the fly so we wouldn&amp;rsquo;t have to do that.&lt;/p&gt;
&lt;p&gt;In theory, I could just add company to the groupBy fields, then merge the rows in the result query as needed. But the problem with that approach is that I can&amp;rsquo;t guarantee I&amp;rsquo;ll get the top 200 by total amount (as was my original query)&lt;/p&gt;
&lt;p&gt;So, the question is: Is there a better way of doing this with a reasonable execution time? Or should I just stick to pre-generating the summary documents?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/11/47333503/</link>
            <pubDate>Thu, 16 Nov 2017 15:31:08 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/11/47333503/</guid>
            <description>
            

            &lt;p&gt;I have a Marklogic 9 project that I&amp;rsquo;m configuring with Roxy.
I&amp;rsquo;ve been following these examples: &lt;a href=&#34;https://github.com/marklogic-community/roxy/wiki/Adding-Custom-Build-Steps&#34;&gt;https://github.com/marklogic-community/roxy/wiki/Adding-Custom-Build-Steps&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Basically, I have a server-side JS function that I want to call after deploy content. I have something like this:&lt;/p&gt;
&lt;h1 id=&#34;then-you-would-define-your-new-method&#34;&gt;then you would define your new method&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;  def deploy_content
    # you can optionally call the original
    original_deploy_content

    # do your stuff here
    execute_query(%Q{
      xquery version &amp;quot;1.0-ml&amp;quot;;
      xdmp:javascript-eval(&#39;var process = require(&amp;quot;/ingestion/process.sjs&amp;quot;); process.postDeployContent();&#39;)
    },
    :db_name =&amp;gt; @properties[&amp;quot;ml.app-name&amp;quot;] + &amp;quot;-content&amp;quot;)

  end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The xquery being called here evaluates fine when executed via query console. But when I call ml local deploy content, I get the following error:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ERROR: 500 &amp;quot;Internal Server Error&amp;quot;
ERROR: &amp;lt;html xmlns=&amp;quot;http://www.w3.org/1999/xhtml&amp;quot;&amp;gt;
  &amp;lt;head&amp;gt;
    &amp;lt;title&amp;gt;500 Internal Server Error&amp;lt;/title&amp;gt;
    &amp;lt;meta name=&amp;quot;robots&amp;quot; content=&amp;quot;noindex,nofollow&amp;quot;/&amp;gt;
    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;/error.css&amp;quot;/&amp;gt;
  &amp;lt;/head&amp;gt;
  &amp;lt;body&amp;gt;
    &amp;lt;span class=&amp;quot;error&amp;quot;&amp;gt;
      &amp;lt;h1&amp;gt;500 Internal Server Error&amp;lt;/h1&amp;gt;
      &amp;lt;dl&amp;gt;
        &amp;lt;dt&amp;gt;XDMP-MODNOTFOUND: var process = require(&amp;quot;/ingestion/process.sjs&amp;quot;); process.postDeployContent(); -- Module /ingestion/process.sjs not found&amp;lt;/dt&amp;gt;
        &amp;lt;dd&amp;gt;&amp;lt;/dd&amp;gt;
        &amp;lt;dt&amp;gt;in [anonymous], at 1:14 [javascript]&amp;lt;/dt&amp;gt;
        &amp;lt;dd&amp;gt;&amp;lt;/dd&amp;gt;
        &amp;lt;dt&amp;gt;at 3:6,
in xdmp:eval(&amp;quot;var process = require(&amp;amp;amp;quot;/ingestion/process.sjs&amp;amp;amp;quot;); proce...&amp;quot;) [javascript]&amp;lt;/dt&amp;gt;
        &amp;lt;dd&amp;gt;&amp;lt;/dd&amp;gt;
        &amp;lt;dt&amp;gt;in /eval, at 3:6 [1.0-ml]&amp;lt;/dt&amp;gt;
        &amp;lt;dd&amp;gt;&amp;lt;/dd&amp;gt;
      &amp;lt;/dl&amp;gt;
    &amp;lt;/span&amp;gt;
  &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Why is the module not found when running via xquery from app_specific.rb?&lt;/p&gt;
&lt;p&gt;Or&amp;hellip; is there a better way to call a JS module function from here. Sorry, I&amp;rsquo;m not too familiar with the xquery side, so I just called a JS function instead.&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/11/47129470/</link>
            <pubDate>Mon, 06 Nov 2017 03:48:06 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/11/47129470/</guid>
            <description>
            

            &lt;p&gt;Does Roxy have support for deploying templates for use with Marklogic 9&amp;rsquo;s Template Driven Extraction?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/10/47018820/</link>
            <pubDate>Mon, 30 Oct 2017 15:22:49 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/10/47018820/</guid>
            <description>
            

            &lt;p&gt;I&amp;rsquo;m trying out the Roxy deployer. The Roxy app was created using the default app-type. I setup a new ML 9 database, and I ran &amp;ldquo;ml local bootstrap&amp;rdquo; using the default ports (8040 and 8041)&lt;/p&gt;
&lt;p&gt;Then I setup a node application. I tried the following (sample code from &lt;a href=&#34;https://docs.marklogic.com/jsdoc/index.html&#34;&gt;https://docs.marklogic.com/jsdoc/index.html&lt;/a&gt;)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;var marklogic = require(&#39;marklogic&#39;);
var conn = {
    host: &#39;192.168.33.10&#39;,  
    port: 8040,
    user: &#39;admin&#39;,
    password: &#39;admin&#39;,
    authType: &#39;DIGEST&#39;
}

var db = marklogic.createDatabaseClient(conn);

db.createCollection(
  &#39;/books&#39;,
  {author: &#39;Beryl Markham&#39;},
  {author: &#39;WG Sebald&#39;}
  )
.result(function(response) {
    console.log(JSON.stringify(response, null, 2));
  }, function (error) {
    console.log(JSON.stringify(error, null, 2));
  });
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Running the script gave me an error like:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ node test.js
{
  &amp;quot;message&amp;quot;: &amp;quot;write document list: cannot process response with 500 status&amp;quot;,
  &amp;quot;statusCode&amp;quot;: 500,
  &amp;quot;body&amp;quot;: &amp;quot;&amp;lt;error:error xsi:schemaLocation=\&amp;quot;http://marklogic.com/xdmp/error error.xsd\&amp;quot; xmlns:error=\&amp;quot;http://marklogic.com/xdmp/error\&amp;quot; xmlns:xsi=\&amp;quot;http://www.w3.org/2001/XMLSchema-instance\&amp;quot;&amp;gt;\n  &amp;lt;error:code&amp;gt;XDMP-IMPMODNS&amp;lt;/error:code&amp;gt;\n  &amp;lt;error:name&amp;gt;err:XQST0059&amp;lt;/error:name&amp;gt;\n  &amp;lt;error:xquery-version&amp;gt;1.0-ml&amp;lt;/error:xquery-version&amp;gt;\n  &amp;lt;error:message&amp;gt;Import module namespace mismatch&amp;lt;/error:message&amp;gt;\n  &amp;lt;error:format-string&amp;gt;XDMP-IMPMODNS: (err:XQST0059) Import module namespace http://marklogic.com/rest-api/endpoints/config does not match target namespace http://marklogic.com/rest-api/endpoints/config_DELETE_IF_UNUSED of imported module /MarkLogic/rest-api/endpoints/config.xqy&amp;lt;/error:format-string&amp;gt;\n  &amp;lt;error:retryable&amp;gt;false&amp;lt;/error:retryable&amp;gt;\n  &amp;lt;error:expr/&amp;gt;\n  &amp;lt;error:data&amp;gt;\n    &amp;lt;error:datum&amp;gt;http://marklogic.com/rest-api/endpoints/config&amp;lt;/error:datum&amp;gt;\n    &amp;lt;error:datum&amp;gt;http://marklogic.com/rest-api/endpoints/config_DELETE_IF_UNUSED&amp;lt;/error:datum&amp;gt;\n    &amp;lt;error:datum&amp;gt;/MarkLogic/rest-api/endpoints/config.xqy&amp;lt;/error:datum&amp;gt;\n  &amp;lt;/error:data&amp;gt;\n  &amp;lt;error:stack&amp;gt;\n    &amp;lt;error:frame&amp;gt;\n      &amp;lt;error:uri&amp;gt;/roxy/lib/rewriter-lib.xqy&amp;lt;/error:uri&amp;gt;\n      &amp;lt;error:line&amp;gt;5&amp;lt;/error:line&amp;gt;\n      &amp;lt;error:column&amp;gt;0&amp;lt;/error:column&amp;gt;\n      &amp;lt;error:xquery-version&amp;gt;1.0-ml&amp;lt;/error:xquery-version&amp;gt;\n    &amp;lt;/error:frame&amp;gt;\n  &amp;lt;/error:stack&amp;gt;\n&amp;lt;/error:error&amp;gt;\n&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If I change the port to 8000 (the default appserver that inserts into Documents), the node function executes correctly as expected. I&amp;rsquo;m not sure if I need to configure anything else with the Roxy-created appserver so that it works with the node.js application.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m not sure where the &amp;ldquo;DELETE_IF_UNUSED&amp;rdquo; part in the error message is coming from either. There doesn&amp;rsquo;t seem to be any such text in the configuration files generated by Roxy.&lt;/p&gt;
&lt;p&gt;Edit: When accessing 192.168.33.10:8040 via the browser, I get a an xml with a similar error:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;error:error xsi:schemaLocation=&amp;quot;http://marklogic.com/xdmp/error error.xsd&amp;quot; xmlns:error=&amp;quot;http://marklogic.com/xdmp/error&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&amp;gt;
  &amp;lt;error:code&amp;gt;XDMP-IMPMODNS&amp;lt;/error:code&amp;gt;
  &amp;lt;error:name&amp;gt;err:XQST0059&amp;lt;/error:name&amp;gt;
  &amp;lt;error:xquery-version&amp;gt;1.0-ml&amp;lt;/error:xquery-version&amp;gt;
  &amp;lt;error:message&amp;gt;Import module namespace mismatch&amp;lt;/error:message&amp;gt;
  &amp;lt;error:format-string&amp;gt;XDMP-IMPMODNS: (err:XQST0059) Import module namespace http://marklogic.com/rest-api/endpoints/config does not match target namespace http://marklogic.com/rest-api/endpoints/config_DELETE_IF_UNUSED of imported module /MarkLogic/rest-api/endpoints/config.xqy&amp;lt;/error:format-string&amp;gt;
  &amp;lt;error:retryable&amp;gt;false&amp;lt;/error:retryable&amp;gt;
  &amp;lt;error:expr/&amp;gt;
  &amp;lt;error:data&amp;gt;
    &amp;lt;error:datum&amp;gt;http://marklogic.com/rest-api/endpoints/config&amp;lt;/error:datum&amp;gt;
    &amp;lt;error:datum&amp;gt;http://marklogic.com/rest-api/endpoints/config_DELETE_IF_UNUSED&amp;lt;/error:datum&amp;gt;
    &amp;lt;error:datum&amp;gt;/MarkLogic/rest-api/endpoints/config.xqy&amp;lt;/error:datum&amp;gt;
  &amp;lt;/error:data&amp;gt;
  &amp;lt;error:stack&amp;gt;
    &amp;lt;error:frame&amp;gt;
      &amp;lt;error:uri&amp;gt;/roxy/lib/rewriter-lib.xqy&amp;lt;/error:uri&amp;gt;
      &amp;lt;error:line&amp;gt;5&amp;lt;/error:line&amp;gt;
      &amp;lt;error:column&amp;gt;0&amp;lt;/error:column&amp;gt;
      &amp;lt;error:xquery-version&amp;gt;1.0-ml&amp;lt;/error:xquery-version&amp;gt;
    &amp;lt;/error:frame&amp;gt;
  &amp;lt;/error:stack&amp;gt;
&amp;lt;/error:error&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If it matters, MarkLogic version is 9.0-3.1. It&amp;rsquo;s a fresh install too.&lt;/p&gt;
&lt;p&gt;Any advice?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/10/47009063/</link>
            <pubDate>Mon, 30 Oct 2017 06:15:37 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/10/47009063/</guid>
            <description>
            

            &lt;p&gt;I&amp;rsquo;m trying to migrate one of my dev envts from ML8 to ML9. I have an import script that successfully works on the ML8 version, but there&amp;rsquo;s an error when I try running it against the ML9 database. The ML9 version is 9.0.3.1. The MLCP version is 9.0.3&lt;/p&gt;
&lt;p&gt;My MLCP options file is as follows:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import
-host 
192.168.33.10
-port 
8041
-username 
admin
-password
admin
-input_file_path 
d:\maroon\data\mbastest.csv 
-mode 
local 
-input_file_type 
delimited_text 
-uri_id 
ClientId 
-output_uri_prefix
/test/records/
-output_uri_suffix 
.json 
-document_type 
json 
-transform_module 
/ingestion/transform.js
-transform_function 
testTransform
-transform_param
test
-content_encoding 
windows-1252 
-thread_count
1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here&amp;rsquo;s the output of a test run with only 2 records in the test CSV file:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;17/10/30 14:07:33 INFO contentpump.LocalJobRunner: Content type: JSON
17/10/30 14:07:33 INFO contentpump.ContentPump: Job name: local_455168344_1
17/10/30 14:07:33 INFO contentpump.FileAndDirectoryInputFormat: Total input paths to process : 1
17/10/30 14:07:38 WARN contentpump.TransformWriter: Failed document /test/records/31.json
17/10/30 14:07:38 WARN contentpump.TransformWriter: &amp;lt;error:format-string xmlns:error=&amp;quot;http://marklogic.com/xdmp/error&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&amp;gt;XDMP-UNEXPECTED: (err:XPST0003) Unexpected token syntax error, unexpected QName_, expecting $end or SemiColon_&amp;lt;/error:format-string&amp;gt;
17/10/30 14:07:38 WARN contentpump.TransformWriter: Failed document /test/records/32.json
17/10/30 14:07:38 WARN contentpump.TransformWriter: &amp;lt;error:format-string xmlns:error=&amp;quot;http://marklogic.com/xdmp/error&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&amp;gt;XDMP-UNEXPECTED: (err:XPST0003) Unexpected token syntax error, unexpected QName_, expecting $end or SemiColon_&amp;lt;/error:format-string&amp;gt;
17/10/30 14:07:38 INFO contentpump.LocalJobRunner:  completed 100%
17/10/30 14:07:38 INFO contentpump.LocalJobRunner: com.marklogic.mapreduce.MarkLogicCounter:
17/10/30 14:07:38 INFO contentpump.LocalJobRunner: INPUT_RECORDS: 2
17/10/30 14:07:38 INFO contentpump.LocalJobRunner: OUTPUT_RECORDS: 2
17/10/30 14:07:38 INFO contentpump.LocalJobRunner: OUTPUT_RECORDS_COMMITTED: 0
17/10/30 14:07:38 INFO contentpump.LocalJobRunner: OUTPUT_RECORDS_FAILED: 2
17/10/30 14:07:38 INFO contentpump.LocalJobRunner: Total execution time: 5 sec
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If I remove the transform params, the import works fine.&lt;/p&gt;
&lt;p&gt;I thought it might be a parsing issue with my transform module itself, so I tried replacing it with the following example from the documentation:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// Add a property named &amp;quot;NEWPROP&amp;quot; to any JSON input document.
// Otherwise, input passes through unchanged.

function addProp(content, context)
{
  const propVal = (context.transform_param == undefined)
                 ? &amp;quot;UNDEFINED&amp;quot; : context.transform_param;

  if (xdmp.nodeKind(content.value) == &#39;document&#39; &amp;amp;&amp;amp;
      content.value.documentFormat == &#39;JSON&#39;) {
    // Convert input to mutable object and add new property
    const newDoc = content.value.toObject();
    newDoc.NEWPROP = propVal;

    // Convert result back into a document
    content.value = xdmp.unquote(xdmp.quote(newDoc));
  }
  return content;
};

exports.addProp = addProp;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(Of course I changed the params in the MLCP options file accordingly)&lt;/p&gt;
&lt;p&gt;The issue still persists even with just this test function.&lt;/p&gt;
&lt;p&gt;Any advice?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/09/46263980/</link>
            <pubDate>Sun, 17 Sep 2017 12:17:12 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/09/46263980/</guid>
            <description>
            

            &lt;p&gt;I&amp;rsquo;m using ML8. I have a bunch of json documents in the database. Some documents have a certain property &amp;ldquo;summaryData&amp;rdquo;, something like:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{
...(other stuff)...
  summaryData: {
    count: 100,
    total: 10000,
    summaryDate: (date value)
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, not all documents have this property. I&amp;rsquo;d like to construct an SJS query to retrieve those documents that don&amp;rsquo;t have this property defined. If it was SQL, I guess the equivalent would be something like &amp;ldquo;WHERE summaryData IS NULL&amp;rdquo;&lt;/p&gt;
&lt;p&gt;I wasn&amp;rsquo;t sure what to search for in the docs. Any advise would be helpful.&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/09/46112486/</link>
            <pubDate>Fri, 08 Sep 2017 08:53:55 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/09/46112486/</guid>
            <description>
            

            &lt;p&gt;I&amp;rsquo;m using ML8 and Node.js. The documentation here: &lt;a href=&#34;http://docs.marklogic.com/guide/node-dev/documents#id_68765&#34;&gt;http://docs.marklogic.com/guide/node-dev/documents#id_68765&lt;/a&gt; describes how to do conditional updates in ML using the versionId field.&lt;/p&gt;
&lt;p&gt;But for example if I want to do a conditional update on a different field, is it possible?&lt;/p&gt;
&lt;p&gt;My scenario is: I have JSON documents with elements assignedTo and assignDate (where assignDate is set to current date every time a new value is set to assignedTo)&lt;/p&gt;
&lt;p&gt;Now, for my &amp;ldquo;Assign&amp;rdquo; operation, I would like to make sure that no one else has changed the assignedTo/assignDate fields between the time I read the document and when I perform the update. I don&amp;rsquo;t care if other fields in the same document have been updated or not - if other fields have been updated, I can still proceed with the Assign operation (hence I cannot use the versionId approach, since that covers the whole document)&lt;/p&gt;
&lt;p&gt;How can this be done?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/08/45901868/</link>
            <pubDate>Sun, 27 Aug 2017 05:09:50 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/08/45901868/</guid>
            <description>
            

            &lt;p&gt;Sorry if the title is unclear, but I&amp;rsquo;m finding my problem hard to explain concisely. I have a number of JSON documents with structure like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{
  &amp;quot;count&amp;quot;: 100,
  &amp;quot;groups&amp;quot;: [
    {
    &amp;quot;name&amp;quot;: &amp;quot;group A&amp;quot;,
    &amp;quot;count&amp;quot;: 12
    },
    {
    &amp;quot;name&amp;quot;: &amp;quot;group B&amp;quot;,
    &amp;quot;count&amp;quot;: 22
    },
    {
    &amp;quot;name&amp;quot;: &amp;quot;group C&amp;quot;,
    &amp;quot;count&amp;quot;: 7
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Basically, the document has an item count plus a breakdown of that count into smaller groups. So this record represents a collection of 100 items, of which 12 are from group A, 22 are from group B, 7 are from group C.&lt;/p&gt;
&lt;p&gt;Now, I have an element range index on &amp;ldquo;count&amp;rdquo; and a bunch of such documents. I&amp;rsquo;d like to be able to sort by any of the options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sort by total count (descending or ascending)&lt;/li&gt;
&lt;li&gt;sort by group A count (descending or ascending)&lt;/li&gt;
&lt;li&gt;sort by group B count (descending or ascending)&lt;/li&gt;
&lt;li&gt;sort by group C count (descending or ascending)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I&amp;rsquo;ve tried&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;.orderBy(qb.sort(&amp;quot;count&amp;quot;, &amp;quot;descending&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This seems to be sort by the total cost (the one in the document root), but I&amp;rsquo;m not sure if that&amp;rsquo;s always true or I need to specify something else to guarantee it always gets that particular one.&lt;/p&gt;
&lt;p&gt;For sorting by a specific group, I have no idea how to specify it.&lt;/p&gt;
&lt;p&gt;Any advice?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/08/45623599/</link>
            <pubDate>Thu, 10 Aug 2017 21:19:20 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/08/45623599/</guid>
            <description>
            

            &lt;p&gt;We&amp;rsquo;ve been trying to set up flexible replication in our system which uses a MarkLogic database.
We followed the instructions from &lt;a href=&#34;https://docs.marklogic.com/8.0/guide/flexrep/quick_start&#34;&gt;https://docs.marklogic.com/8.0/guide/flexrep/quick_start&lt;/a&gt; and have been able to set up flexible replication between two MarkLogic servers. We have verified that new documents created in the master are copied over to the replica. However, the master database currently has more than 47 million records that were there before we configured the replication. Once the replication process was triggered, we observed that the documents are being replicated to the replica very slowly. Roughly 20,000 documents were replicated within the first two hours. The rate is very slow, it would take months for the old records to be fully replicated.&lt;/p&gt;
&lt;p&gt;Our questions are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;We are looking into increasing the hardware specs of the two servers, but aside from that would anyone have any advice or documentation as to how we could speed up the replication? I couldn&amp;rsquo;t find any existing documentation regarding this?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Failing that, would it be possible to set up flexible replication without needing to replicate the initial data set? FYI, we also tried to clone the master database and use the clone as the replica. (We thought this might mean that the older records don&amp;rsquo;t have to be replicated.) However, in this case we encountered XDMP-NEWSTAMP and XDMP-EXTIME errors on the replica server, so we gave up on this approach. A sample of the errors encountered on the replica is below:&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;2017-08-03 18:45:04.376 Notice: exp-rest-content-flexrep:
XDMP-NEWSTAMP: Timestamp too new for forest exp-rest-content-001-1
(15017569242290900) 2017-08-03 18:45:04.376 Notice:
exp-rest-content-flexrep: in /apply.xqy [1.0-ml] 2017-08-03
18:45:04.379 Notice: TaskServer: XDMP-EXTIME: try { let
$raw-module-name := module-path($action-to-execute/p:module) let
$module-kind := module-kind($raw-module-name) let $module-name := if
($module-kind = &amp;ldquo;xquery&amp;rdquo; or $module-kind = &amp;ldquo;javascript&amp;rdquo;) then
$raw-module-name else $cpfi:xslt-action return if ($module-name = &amp;ldquo;&amp;quot;)
then fn:error((), &amp;ldquo;CPF-ACTIONNOTFOUND&amp;rdquo;, &amp;ldquo;Default success&amp;rdquo;) else if
($module-kind = &amp;ldquo;javascript&amp;rdquo;) then (xdmp:trace(&amp;ldquo;CPF Action Invoke&amp;rdquo;,
fn:string-join(($caller, xdmp:get-current-user(), $uri,
$state-or-status, $raw-module-name), &amp;quot; &amp;ldquo;)), xdmp:invoke($module-name,
(fn:QName(&amp;quot;&amp;rdquo;,&amp;ldquo;uri&amp;rdquo;), $uri, xs:QName(&amp;ldquo;cpf:document-uri&amp;rdquo;), $uri,
fn:QName(&amp;quot;&amp;rdquo;,&amp;ldquo;transition&amp;rdquo;), $chosen-transition,
options-var-js($action-to-execute)), $invoke-options)) else
(xdmp:trace(&amp;ldquo;CPF Action Invoke&amp;rdquo;, fn:string-join(($caller,
xdmp:get-current-user(), $uri, $state-or-status, $raw-module-name), &amp;quot;
&amp;ldquo;)), xdmp:invoke($module-name, ($vars, xs:QName(&amp;ldquo;cpf:transition&amp;rdquo;),
$chosen-transition, options-var($action-to-execute), if ($module-kind
= &amp;ldquo;xslt&amp;rdquo;) then (xs:QName(&amp;ldquo;cpf:stylesheet-uri&amp;rdquo;), $raw-module-name) else ()), $invoke-options)) } catch ($e) { let $trace := let $context :=
fn:concat($caller, &amp;quot; &amp;ldquo;, $uri, &amp;quot; action failed&amp;rdquo;) return
(cpf:log(fn:string-join(($context, $e/err:format-string), &amp;quot; &amp;ldquo;),
&amp;ldquo;error&amp;rdquo;), cpf:log(($context, $e), &amp;ldquo;fine&amp;rdquo;)) let $failure-action :=
($pipelines/p:failure-action)[1] let $raw-failure-module :=
module-path($failure-action/p:module) let $failure-kind :=
module-kind($raw-failure-module) let $failure-module := if
($failure-kind = &amp;ldquo;xquery&amp;rdquo; or $failure-kind = &amp;ldquo;javascript&amp;rdquo;) then
$raw-failure-module else $cpfi:xslt-action return if ($failure-module
= &amp;ldquo;&amp;quot;) then fn:error((), &amp;ldquo;CPF-ACTIONNOTFOUND&amp;rdquo;, &amp;ldquo;Default failure action&amp;rdquo;) else xdmp:invoke($failure-module, ($vars,
xs:QName(&amp;ldquo;cpf:transition&amp;rdquo;), $chosen-transition,
options-var($failure-action), xs:QName(&amp;ldquo;cpf:exception&amp;rdquo;), $e, if
($failure-kind = &amp;ldquo;xslt&amp;rdquo;) then (xs:QName(&amp;ldquo;cpf:stylesheet-uri&amp;rdquo;),
$raw-failure-module) else ()), $invoke-options) } &amp;ndash; Time limit
exceeded 2017-08-03 18:45:04.379 Notice: TaskServer: in
/MarkLogic/cpf/triggers/internal-cpf.xqy, at 213:4, 2017-08-03
18:45:04.379 Notice: TaskServer: in execute-action(&amp;ldquo;on-state-enter&amp;rdquo;,
&amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22,&#34;&gt;http://marklogic.com/states/initial&amp;quot;,&lt;/a&gt; &amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;,
(xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;), &amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;,
xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;), &lt;options
xmlns=&#34;xdmp:eval&#34;&gt;&lt;isolation&gt;different-transaction&lt;/isolation&gt;&lt;prevent-deadlocks&gt;t&amp;hellip;&lt;/options&gt;,
(fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/12349495875628658916.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/12349495875628658916.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/13179541037342910978.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/13179541037342910978.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
&amp;hellip;),
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline/p:state-transition%5B3%5D/p:default-action,&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline/p:state-transition[3]/p:default-action,&lt;/a&gt; fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline/p:state-transition%5B3&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline/p:state-transition[3&lt;/a&gt;])
[1.0-ml] 2017-08-03 18:45:04.379 Notice: TaskServer:   $caller =
&amp;ldquo;on-state-enter&amp;rdquo; 2017-08-03 18:45:04.379 Notice: TaskServer:&lt;br&gt;
$state-or-status = &amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22&#34;&gt;http://marklogic.com/states/initial&amp;quot;&lt;/a&gt; 2017-08-03
18:45:04.379 Notice: TaskServer:   $uri = &amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;
2017-08-03 18:45:04.379 Notice: TaskServer:   $vars =
(xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;), &amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;,
xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;) 2017-08-03 18:45:04.379 Notice:
TaskServer:   $invoke-options = &lt;options
xmlns=&#34;xdmp:eval&#34;&gt;&lt;isolation&gt;different-transaction&lt;/isolation&gt;&lt;prevent-deadlocks&gt;t&amp;hellip;&lt;/options&gt;
2017-08-03 18:45:04.379 Notice: TaskServer:   $pipelines =
(fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/12349495875628658916.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/12349495875628658916.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/13179541037342910978.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/13179541037342910978.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
&amp;hellip;) 2017-08-03 18:45:04.379 Notice: TaskServer:   $action-to-execute
= fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline/p:state-transition%5B3%5D/p:default-action&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline/p:state-transition[3]/p:default-action&lt;/a&gt; 2017-08-03 18:45:04.379 Notice: TaskServer:   $chosen-transition =
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline/p:state-transition%5B3%5D&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline/p:state-transition[3]&lt;/a&gt;
2017-08-03 18:45:04.379 Notice: TaskServer:   $e = &amp;lt;error:error
xsi:schemaLocation=&amp;quot;http://marklogic.com/xdmp/error error.xsd&amp;rdquo;
xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;rdquo;
xmlns:error=&amp;quot;http://marklogic.com/xdmp/error&amp;quot;&amp;gt;&lt;a href=&#34;error:code&#34;&gt;error:code&lt;/a&gt;XDMP-NEWSTAMP&amp;lt;/error:code&amp;gt;&lt;a href=&#34;error:name/&#34;&gt;error:name/&lt;/a&gt;&amp;lt;error:xquery&amp;hellip;&amp;lt;/error:error&amp;gt; 2017-08-03 18:45:04.379 Notice: TaskServer: in
/MarkLogic/cpf/triggers/internal-cpf.xqy, at 342:6, 2017-08-03
18:45:04.379 Notice: TaskServer: in
execute-transition(&amp;ldquo;on-state-enter&amp;rdquo;,
&amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22,&#34;&gt;http://marklogic.com/states/initial&amp;quot;,&lt;/a&gt; &amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;,
(xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;), &amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;,
xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;), &amp;lt;trgr:trigger
xmlns:trgr=&amp;quot;http://marklogic.com/xdmp/triggers&amp;quot;&amp;gt;&lt;a href=&#34;trgr:trigger-id&#34;&gt;trgr:trigger-id&lt;/a&gt;6551367241994447650&amp;lt;/trgr:trigger-id&amp;gt;&amp;lt;trgr:trig&amp;hellip;&amp;lt;/trgr:trigger&amp;gt;, (fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/12349495875628658916.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/12349495875628658916.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/13179541037342910978.xml%22)/p:pipeline,&#34;&gt;http://marklogic.com/cpf/pipelines/13179541037342910978.xml&amp;quot;)/p:pipeline,&lt;/a&gt;
&amp;hellip;),
(fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/12349495875628658916.xml%22)/p:pipeline/p:state-transition%5B2%5D,&#34;&gt;http://marklogic.com/cpf/pipelines/12349495875628658916.xml&amp;quot;)/p:pipeline/p:state-transition[2],&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/3358424510998587926.xml%22)/p:pipeline/p:state-transition%5B3%5D,&#34;&gt;http://marklogic.com/cpf/pipelines/3358424510998587926.xml&amp;quot;)/p:pipeline/p:state-transition[3],&lt;/a&gt;
fn:doc(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/cpf/pipelines/13179541037342910978.xml%22)/p:pipeline/p:state-transition%5B1%5D,&#34;&gt;http://marklogic.com/cpf/pipelines/13179541037342910978.xml&amp;quot;)/p:pipeline/p:state-transition[1],&lt;/a&gt;
&amp;hellip;), &amp;lt;p:null-transition
xmlns:p=&amp;quot;http://marklogic.com/cpf/pipelines&amp;quot;&amp;gt;&amp;lt;p:state&amp;gt;http://marklogic.com/states/initial&amp;lt;/p:state&amp;gt;&amp;lt;/p:null-transition&amp;gt;)
[1.0-ml] 2017-08-03 18:45:04.379 Notice: TaskServer:   $caller =
cpf:state(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22&#34;&gt;http://marklogic.com/states/initial&amp;quot;&lt;/a&gt;) 2017-08-03
18:45:04.379 Notice: TaskServer:   $state-or-status = () 2017-08-03
18:45:04.379 Notice: TaskServer:   $uri = (xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;),
&amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;, xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;) 2017-08-03
18:45:04.379 Notice: TaskServer: in
/MarkLogic/cpf/triggers/internal-cpf.xqy, at 358:3, 2017-08-03
18:45:04.379 Notice: TaskServer: in
int:execute-state-transition(&amp;ldquo;on-state-enter&amp;rdquo;,
cpf:state(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22),&#34;&gt;http://marklogic.com/states/initial&amp;quot;),&lt;/a&gt;
&amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;, (xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;),
&amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;, xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;), &amp;lt;trgr:trigger
xmlns:trgr=&amp;quot;http://marklogic.com/xdmp/triggers&amp;quot;&amp;gt;&lt;a href=&#34;trgr:trigger-id&#34;&gt;trgr:trigger-id&lt;/a&gt;6551367241994447650&amp;lt;/trgr:trigger-id&amp;gt;&amp;lt;trgr:trig&amp;hellip;&amp;lt;/trgr:trigger&amp;gt;) [1.0-ml] 2017-08-03 18:45:04.379 Notice: TaskServer:   $caller =
cpf:state(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22&#34;&gt;http://marklogic.com/states/initial&amp;quot;&lt;/a&gt;) 2017-08-03
18:45:04.379 Notice: TaskServer:   $state = () 2017-08-03 18:45:04.379
Notice: TaskServer:   $uri = (xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;),
&amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;, xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;) 2017-08-03
18:45:04.379 Notice: TaskServer: in
/MarkLogic/cpf/triggers/on-state-enter.xqy, at 41:6 [1.0-ml]
2017-08-03 18:45:04.379 Notice: TaskServer:   $state =
cpf:state(&amp;ldquo;&lt;a href=&#34;http://marklogic.com/states/initial%22&#34;&gt;http://marklogic.com/states/initial&amp;quot;&lt;/a&gt;) 2017-08-03
18:45:04.379 Notice: TaskServer:   $trace = () 2017-08-03 18:45:04.379
Notice: TaskServer:   $vars = (xs:QName(&amp;ldquo;trgr:uri&amp;rdquo;),
&amp;ldquo;/_smslogs/5849823.xml&amp;rdquo;, xs:QName(&amp;ldquo;trgr:trigger&amp;rdquo;), &amp;hellip;) 2017-08-03
18:45:04.379 Notice: TaskServer: XDMP-NEWSTAMP: Timestamp too new for
forest exp-rest-content-001-1 (15017569242290900) 2017-08-03
18:45:04.379 Notice: exp-rest-content-flexrep: XDMP-NEWSTAMP:
Timestamp too new for forest exp-rest-content-001-1
(15017569242290900) 2017-08-03 18:45:04.379 Notice:
exp-rest-content-flexrep: in /apply.xqy [1.0-ml]&lt;/p&gt;
&lt;/blockquote&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/08/45507423/</link>
            <pubDate>Fri, 04 Aug 2017 12:55:30 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/08/45507423/</guid>
            <description>
            

            &lt;p&gt;We have a search application using MarkLogic node.js. We use parsedQuery like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;            qb.parsedFrom(prop.search, 
            qb.parseBindings(
                qb.word(&#39;name&#39;, qb.bind(&#39;name&#39;)),
                qb.word(&#39;birthdate&#39;, qb.bind(&#39;birthdate&#39;)),
                qb.range(&#39;count&#39;, qb.datatype(&#39;float&#39;), qb.bind(&#39;count&#39;))
            )
        )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The above currently supports search syntax like &amp;ldquo;count GT 50&amp;rdquo;, etc. We would like to support searching using a derived value such as age. That is, we want to support a search syntax like &amp;ldquo;age GT 10&amp;rdquo;, where the age value is not stored in the documents in the database but rather needs to be computed from the birthdate on the fly. We can&amp;rsquo;t store the age in the documents since the age changes depending on the current date.&lt;/p&gt;
&lt;p&gt;Is this possible and if so, how? If it matters, we are using ML8&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/08/45463003/</link>
            <pubDate>Wed, 02 Aug 2017 13:58:28 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/08/45463003/</guid>
            <description>
            

            &lt;p&gt;Is there an easy way to delete all the element range indexes on a given database?&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/07/45093664/</link>
            <pubDate>Fri, 14 Jul 2017 02:27:11 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/07/45093664/</guid>
            <description>
            

            &lt;p&gt;I have a number of documents from different sources. Many of them reference a company name, but may have stored the information slightly differently. The name is a field in the documents.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;d like to be able to detect variations on the same name, something like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ajax Company Incorporated&lt;/li&gt;
&lt;li&gt;Ajax Co. Inc.&lt;/li&gt;
&lt;li&gt;Ajax Company Inc.&lt;/li&gt;
&lt;li&gt;Ajax Company&lt;/li&gt;
&lt;li&gt;Ajax Company (formerly Ajax Unlimited)&lt;/li&gt;
&lt;li&gt;etc&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Does MarkLogic have any facility to query documents that have &amp;ldquo;similar&amp;rdquo; name as above? I&amp;rsquo;m not sure if there&amp;rsquo;s a more technical term that I should be searching for. Preferably for either the node client API or server-side js.&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2017/06/44621849/</link>
            <pubDate>Mon, 19 Jun 2017 03:27:09 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2017/06/44621849/</guid>
            <description>
            

            &lt;p&gt;Something similar to my question here: &lt;a href=&#34;https://stackoverflow.com/questions/40715822/marklogic-node-js-api-group-by-and-sort-by-count&#34;&gt;https://stackoverflow.com/questions/40715822/marklogic-node-js-api-group-by-and-sort-by-count&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I have documents in Marklogic with fields &lt;em&gt;name&lt;/em&gt; and &lt;em&gt;amount&lt;/em&gt;. I want to get the total amount for each name. Basically in SQL it would be&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;select name, sum(amount) from table group by name
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have &lt;strong&gt;range indexes&lt;/strong&gt; for both &lt;em&gt;name&lt;/em&gt; and &lt;em&gt;amount&lt;/em&gt;.
For getting sum aggregates, the documentation suggests something like &lt;strong&gt;valuesBuilder.fromIndexes(&amp;lsquo;amount&amp;rsquo;).aggregates(&amp;lsquo;sum&amp;rsquo;)&lt;/strong&gt;, but this only gets the sum for all records, instead of per name like I want.&lt;/p&gt;
&lt;p&gt;Any advice?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2016/12/40968519/</link>
            <pubDate>Mon, 05 Dec 2016 06:44:52 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2016/12/40968519/</guid>
            <description>
            

            &lt;p&gt;I tried to insert the following test document:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;db.documents.write(
    {
        uri: &amp;quot;/test/doc1.json&amp;quot;,
        contentType: &amp;quot;application/json&amp;quot;,
        collections: &amp;quot;test&amp;quot;,
        content: {
            name : &amp;quot;Peter&amp;quot;,
            hobby: &amp;quot;Sleeping&amp;quot;,
            other: &amp;quot;Some other info&amp;quot;,
            &amp;quot;triple&amp;quot;: {
                &amp;quot;subject&amp;quot;: {
                    &amp;quot;datatype&amp;quot;: &amp;quot;http://example.com/name/&amp;quot;,
                    &amp;quot;value&amp;quot;: &amp;quot;Peter&amp;quot;
                },
                &amp;quot;predicate&amp;quot;: {
                    &amp;quot;datatype&amp;quot;: &amp;quot;http://example.com/relation/&amp;quot;,
                    &amp;quot;value&amp;quot;: &amp;quot;livesin&amp;quot;
                },
                &amp;quot;object&amp;quot;: {
                    &amp;quot;datatype&amp;quot;: &amp;quot;http://example.com/location/&amp;quot;,
                    &amp;quot;value&amp;quot;: &amp;quot;Paris&amp;quot;
                }
         	}
        }
    }
  ).
  result(function(response){
    console.log(&amp;quot;Done loading&amp;quot;);
  }); 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I queried as follows:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;var query = [
  &#39;SELECT ?s ?p ?o&#39; ,
  &#39;WHERE { ?s ?p ?o }&#39; ,
];
db.graphs.sparql(&#39;application/sparql-results+json&#39;, query.join(&#39;\n&#39;)
).result(function (result) {
  console.log(JSON.stringify(result, null, 2));
}, function(error) {
  console.log(JSON.stringify(error, null, 2));
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The results showed me the values of the triple, but what if I also want to get the entire document where the triple was embedded? Is it also possible to filter by other fields in the document?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2016/12/40968002/</link>
            <pubDate>Mon, 05 Dec 2016 06:02:58 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2016/12/40968002/</guid>
            <description>
            

            &lt;p&gt;I inserted a test document using the Node.js API:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  db.documents.write(
    {
        uri: &amp;quot;/test/doc1.json&amp;quot;,
        contentType: &amp;quot;application/json&amp;quot;,
        collections: &amp;quot;test&amp;quot;,
        content: {
            name : &amp;quot;Peter&amp;quot;,
            &amp;quot;triple&amp;quot;: {
                &amp;quot;subject&amp;quot;: {
                    &amp;quot;datatype&amp;quot;: &amp;quot;http://example.com/name/&amp;quot;,
                    &amp;quot;value&amp;quot;: &amp;quot;Peter&amp;quot;
                },
                &amp;quot;predicate&amp;quot;: {
                    &amp;quot;datatype&amp;quot;: &amp;quot;http://example.com/relation/&amp;quot;,
                    &amp;quot;value&amp;quot;: &amp;quot;livesin&amp;quot;
                },
                &amp;quot;object&amp;quot;: {
                    &amp;quot;datatype&amp;quot;: &amp;quot;http://example.com/location/&amp;quot;,
                    &amp;quot;value&amp;quot;: &amp;quot;Paris&amp;quot;
                }
         	}
        }
    }
  ).
  result(function(response){
    console.log(&amp;quot;Done loading&amp;quot;);
  }); 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I tried querying it via SPARQL on the Marklogic console webapp:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SELECT ?s ?p ?o
  WHERE { ?s ?p ?o }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The query above works fine, it retrieves the test triple I inserted above&lt;/p&gt;
&lt;p&gt;However, if I want to filter by the literal value &amp;ldquo;Paris&amp;rdquo;, I tried the following:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PREFIX loc: &amp;lt;http://example.com/location/&amp;gt;

SELECT ?s ?p 
  WHERE { ?s ?p loc:Paris }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But in this case I got zero results. Is this syntax incorrect? I was just following how the queries looked in &lt;a href=&#34;https://docs.marklogic.com/guide/semantics/semantic-searches&#34;&gt;https://docs.marklogic.com/guide/semantics/semantic-searches&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What is the proper way to do it?&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2016/11/40720684/</link>
            <pubDate>Mon, 21 Nov 2016 12:52:39 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2016/11/40720684/</guid>
            <description>
            

            &lt;p&gt;I want to retrieve all documents in my MarkLogic db that have month=November and also group them by name, and get the count of records per name. I know I can get the frequency per name by using valuesBuilder with a range index on the name field, but how can I filter this result so that I only get the count of records for the month of November?&lt;/p&gt;
&lt;p&gt;Supposedly valuesBuilder.fromIndexes().where() can do the filtering, but I don&amp;rsquo;t know what to pass here and examples online seem to be sparse.&lt;/p&gt;



            </description>
        </item>
    
        <item>
            <title>New note
</title>
            <link>https://roytang.net/2016/11/40715822/</link>
            <pubDate>Mon, 21 Nov 2016 08:37:08 +0000</pubDate>
            <author>hello@roytang.net (Roy Tang)</author>
            <guid>https://roytang.net/2016/11/40715822/</guid>
            <description>
            

            &lt;p&gt;In a relational db you&amp;rsquo;d have something like &amp;ldquo;select name, count(1) as c from mytable group by name order by c desc&amp;rdquo;. Basically I want to count how many records contain each name value and get the ones with highest counts first.&lt;/p&gt;
&lt;p&gt;Is there a way to do a similar thing in Marklogic using the Node.js API?&lt;/p&gt;



            </description>
        </item>
    
    </channel>
  </rss>