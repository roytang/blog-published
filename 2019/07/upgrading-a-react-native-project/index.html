<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Upgrading a React Native Project  &middot; Roy Tang</title>
  <link rel="authorization_endpoint" href="https://indieauth.com/auth" />
  <link rel="token_endpoint" href="https://tokens.indieauth.com/token">
    
  <link rel="micropub" href="https://apps.roytang.net/blog/micropub">   
  
    
  <link rel="microsub" href="https://aperture.p3k.io/microsub/521">   
  
  
    
    <link rel="webmention" href="https://webmention.io/roytang.net/webmention" />
    <link rel="pingback" href="https://webmention.io/roytang.net/xmlrpc" />  
  
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="Roy Tang&#39;s blog. Programmer, engineer, scientist, critic, gamer, dreamer, and kid-at-heart. Randomly amazed." />

<meta name="keywords" content="software development, react native, mobile, ">


<meta property="og:title" content="Upgrading a React Native Project  &middot; Roy Tang ">
<meta property="og:site_name" content="Roy Tang"/>
<meta property="og:url" content="https://roytang.net/2019/07/upgrading-a-react-native-project/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2019-07-20T05:56:56Z" />
<meta property="og:article:modified_time" content="2019-07-20T05:56:56Z" />

  
    
<meta property="og:article:tag" content="software development">
    
<meta property="og:article:tag" content="react native">
    
<meta property="og:article:tag" content="mobile">
    
  







<meta property="og:image" content='https://roytang.net/img/profile.jpg'>

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@roytang" />
<meta name="twitter:creator" content="@roytang" />
<meta name="twitter:title" content="Upgrading a React Native Project" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://roytang.net/2019/07/upgrading-a-react-native-project/" />
<meta name="twitter:domain" content="https://roytang.net">
<meta name="twitter:image" content='https://roytang.net/img/profile.jpg'>
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Upgrading a React Native Project",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2019-07-20",
    "description": "",
    "wordCount":  1080 
  }
</script>



<link href='https://roytang.net/index.xml' rel="alternate" type="application/rss+xml" title="Upgrading a React Native Project" />

<link rel="canonical" href="https://roytang.net/2019/07/upgrading-a-react-native-project/" />

<link href="https://roytang.net/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.72.0" />

  <link rel="stylesheet" href="https://roytang.net/css/shared.css" type="text/css" />
  <link rel="stylesheet" href="https://roytang.net/css/main.css" type="text/css" title="Default" />
  <link rel="alternate stylesheet" href="https://roytang.net/css/plain.css" type="text/css" title="Plain" />
</head>
<body class="page">
    <div class="wrapper">
        <header class="mainheader h-card vcard about-author">
    <img class="u-photo" src="https://roytang.net/img/profile.jpg" alt="" />
    <div>
        <a style="display: none" href=https://roytang.net class="p-name u-url url author metatag" rel="me">
            Roy Tang
        </a>
        <p class="u-email" style="display:none">hello@roytang.net</p>
        <h1><a class="baselink" href="https://roytang.net">
        Roy Tang
        </a></h1>
        <p class="p-note">Programmer, engineer, scientist, critic, gamer, dreamer, and kid-at-heart.</p>
    </div>
</header>
<div class="secondheader">
    <form class="searchform" action="https://apps.roytang.net/blog/search" role="search" _lpchecked="1">
    <div class="searchflex">
        <input id="searchterm" name="q" class="searchbox" size="15" aria-label="search this site" placeholder="search">
        <input id="submit" type="image" title="Search" alt="Search" src="https://roytang.net/img/search.png">
    </div>
</form>

</div>
<div class="panel">
    
    <a href="https://roytang.net/blog/">Blog</a>
    
    <a href="https://roytang.net/notes/">Notes</a>
    
    <a href="https://roytang.net/photos/">Photos</a>
    
    <a href="https://roytang.net/links/">Links</a>
    
    <a href="https://roytang.net/archives/">Archives</a>
    
    <a href="https://roytang.net/about/">About</a>
    
</div>

        <div class="main_content">

<div class="main">

<article class="list_item post h-entry">
<div class="title">

    <a class="u-url post-title" href="https://roytang.net/2019/07/upgrading-a-react-native-project/"><h3 class="p-name">Upgrading a React Native Project</h3></a>
    <time class="dt-published" datetime="2019-07-20 05:56:56">20 Jul 2019 5:56am</time>

</div>

<div class="e-content">

<p>I have a small mobile app that I wrote using React Native (henceforth RN) back in 2017, currently deployed on the Google Play Store and Apple App Store. Shortly before my US trip, I got an email from Google telling me about a required action:</p>
<blockquote>
<p>By August 1, 2019, all apps that use native code must provide a 64-bit version in addition to the 32-bit version in order to publish an update. This past January, we reiterated that this is required in order to make way for innovation and in anticipation of future Android devices that only support 64-bit code.</p>
<p>As the deadline approaches, we wanted to remind you that at least one of your apps* uses native code but does not currently offer a 64-bit variant</p>
</blockquote>
<p>This illustrates for me one of the big problems with mobile development: that app was perfectly fine when I last deployed it in 2018 and now even though I haven&rsquo;t changed anything, there&rsquo;s additional work that needs to be done. I guess I&rsquo;m too used to web development where we just deploy the app on a server and the server architecture doesn&rsquo;t suddenly change for no reason. With mobile apps, the platforms and APIs and frameworks change quickly, leading to situations where even if your app doesn&rsquo;t have any pending changes, you need to do some work on it anyway. (Granted, this can also happen with webservers due to security patches and such, but with managed hosting, that&rsquo;s not something you worry about as often, and the resolution is often straightforward!)</p>
<p>As I was about to be out of the country on vacation for more than a month, I put this off and only started looking at it when I got back. Luckily, I did actually also have some minor revisions to do on the app, so I would do all the work in one go.</p>
<p>As it turns out, the version of RN I was using was too old and did not support providing the 64-bit version. I had to upgrade to a later version of RN, and after reviewing the process, it seemed like a nontrivial amount of work. There was an upgrade tool, but because I was so many versions behind, it couldn&rsquo;t work directly. The problem seems to be in the initial boilerplate created by <code>react-native init</code> for the ios and android subprojects; the older boilerplate was out of date and needed to be updated, which was not straightforward given that you may have modified that boilerplate afterwards. I had to use some kind of diff tool to manually find the differences in the boilerplate and merge the changes manually.</p>
<p>That seemed like a lot of work, and the app wasn&rsquo;t that large and didn&rsquo;t have that much code, so I figured it was more straightforward to just create a new RN project from scratch, which would be using the latest version of RN (0.60.3, from 0.50.4). Afterwards, I port over the project code into the new project, them swap the new project back into the old project&rsquo;s repo. That way I only had to update the few dependencies I was using in the project itself.</p>
<p>It was still a nontrivial amount of work, but I eventually got everything working through many iterations of trial-and-error.</p>
<ul>
<li>I went ahead and upgraded the dependencies to the latest versions as well, to make sure there was no conflict with the new RN version</li>
<li>ReactNavigation had some backward incompatible changes:
<ul>
<li>needed to <a href="https://reactnavigation.org/docs/en/getting-started.html#installation">initialize the gesture handler</a> in the java class</li>
<li>new function <code>createStackNavigator</code> instead of just <code>StackNavigator</code> constructor</li>
<li>needed to use <code>createAppContainer</code> to initialize the navigator</li>
</ul>
</li>
<li>some components such as WebView and AsyncStorage were no longer part of RN core and had to be imported accordingly</li>
<li>Android now requires that I explicitly prompt for the <code>READ_EXTERNAL_STORAGE</code> permission when trying to access the camera roll</li>
<li>Google now recommends that I provide an upload key for encryption, but since I reset the project, I also accidentally deleted the signing key I was using before. Oops! Momentary panic until I have the sense to do a search and realize that past me was wise enough to backup the file elsewhere.</li>
<li>Test that I can create the app bundle successfully.</li>
</ul>
<p>By this point I more or less had a working Android build, then shifted over to iOS. Since I only <a href="https://roytang.net/2018/12/macbook-air-2017-model/">recently got a Macbook Air</a>, I actually hadn&rsquo;t tried creating and publishing the iOS build, someone was helping me with that part before. Because of reasons, I wanted/had to do it myself this time around, so a bit of a learning curve and trial-and-error again.</p>
<ul>
<li>clone the project from repo, <code>npm install</code>, try <code>react-native run-ios</code>, oops missing dependencies</li>
<li>find out about CocoaPods. Clone a fresh copy of the project, <code>npm install</code> then <code>pod install</code> (took a while), then try <code>react-native run-ios</code> again</li>
<li>needed to fix some dependencies I was using by manual linking and updating</li>
<li>camera roll also needed to be added to the podfile (a config I possibly lost when I reset the project)</li>
<li>fix a bunch of configs before I can actually run and test the app in the simulator</li>
<li>Success!</li>
</ul>
<p>At this point, I make my other app changes and test on both my Android phone and the iOS simulator. The changes are easy, so now to try publishing.</p>
<ul>
<li>Try to publish and upload to iTunesConnect. Takes me a few tries to figure out that I need to be updating stuff like bundle identifier, version number, etc.</li>
<li>iTunesConnect has some new requirements too (like the iPad version needs to support all orientations) which causes a couple more iterations</li>
<li>more screenshots are now required when submitting the app!</li>
<li>I set up TestFlight and verify everything is ok with the published app. (I only tested using the simulator before)</li>
<li>iOS app now submitted and &ldquo;Waiting for Review&rdquo;. I anticipate they will have some ridiculous request and it might take me a couple more submission rounds before I can publish</li>
<li>Google Play is more straightforward. <code>gradlew releaseBundle</code> is already working after my previous effort, so I just upload the bundle and distribute.</li>
</ul>
<p>I see no indication that I have satisfied Google&rsquo;s action item, but it let me publish the update without complaints, so I&rsquo;m done!</p>
<p>My initial estimate that the work was nontrivial ends up correct, I spent way more manhours than I expected on the upgrade. Part of it was learning how to do the iOS deployment, so hopefully that ends up easier in the future.</p>





<div class="image-list" id="resources">




</div>





</div>


<div class="meta">
    Posted by <a rel="author" class="p-author h-card" href="https://roytang.net">Roy Tang</a> under <a href="https://roytang.net/post">post</a> at 
    <a href="https://roytang.net/2019/07/upgrading-a-react-native-project/"><time class="dt-published" datetime="2019-07-20 05:56:56">20 Jul 2019 5:56am</time></a>

    

<a class="tag p-category" href="https://roytang.net/tags/software-development">#software development</a>

<a class="tag p-category" href="https://roytang.net/tags/react-native">#react native</a>

<a class="tag p-category" href="https://roytang.net/tags/mobile">#mobile</a>




    <br />
    
Also on: 

    <a rel="syndication" title="View on twitter" class='u-syndication' href="https://twitter.com/roytang/statuses/1152458840299974657/" title="View on twitter">twitter</a>



    /
    
    
    
    <a href="https://roytang.net/2019/07/upgrading-a-react-native-project/#header-comments">
        <svg class="svg-icon" viewBox="0 0 20 20" width="12" height="12">
            <path d="M14.999,8.543c0,0.229-0.188,0.417-0.416,0.417H5.417C5.187,8.959,5,8.772,5,8.543s0.188-0.417,0.417-0.417h9.167C14.812,8.126,14.999,8.314,14.999,8.543 M12.037,10.213H5.417C5.187,10.213,5,10.4,5,10.63c0,0.229,0.188,0.416,0.417,0.416h6.621c0.229,0,0.416-0.188,0.416-0.416C12.453,10.4,12.266,10.213,12.037,10.213 M14.583,6.046H5.417C5.187,6.046,5,6.233,5,6.463c0,0.229,0.188,0.417,0.417,0.417h9.167c0.229,0,0.416-0.188,0.416-0.417C14.999,6.233,14.812,6.046,14.583,6.046 M17.916,3.542v10c0,0.229-0.188,0.417-0.417,0.417H9.373l-2.829,2.796c-0.117,0.116-0.71,0.297-0.71-0.296v-2.5H2.5c-0.229,0-0.417-0.188-0.417-0.417v-10c0-0.229,0.188-0.417,0.417-0.417h15C17.729,3.126,17.916,3.313,17.916,3.542 M17.083,3.959H2.917v9.167H6.25c0.229,0,0.417,0.187,0.417,0.416v1.919l2.242-2.215c0.079-0.077,0.184-0.12,0.294-0.12h7.881V3.959z"></path>
        </svg>
        0</a>

    
    
    / 1080 words
    
</div>

<div class="comments">




<h3>See Also</h3>
<ul>
    
    <li><a href="https://roytang.net/2019/07/10x-programmers/">10X Programmers</a></li>
    
    <li><a href="https://roytang.net/2019/04/learning-from-failure/">Learning from failure</a></li>
    
    <li><a href="https://roytang.net/2018/10/django-blog-application/">Django Blog Application</a></li>
    
    <li><a href="https://roytang.net/2009/02/stylesheet-switcher-using-django/">Stylesheet Switcher using Django</a></li>
    
    <li><a href="https://roytang.net/2009/01/using-django-pingback/">Using Django Pingback</a></li>
    
</ul>





    




<div class="feedback">If you enjoyed my content for some reason, I'd love to hear from you! Here are some options:
<ul>
    <li>You can <a href="https://ko-fi.com/roytang">buy me a coffee!</a></li>


    
    <li>You can <a href="https://twitter.com/roytang/statuses/1152458840299974657/">share or reply to this post on Twitter</a>. </li>
    
    



    

 


  
<li>You can write a reply on your own site and submit the URL as a <a href="https://indieweb.org/webmention">webmention</a> via the form below.
    <form id="webmention-form" action="https://webmention.io/roytang.net/webmention" method="POST">
        <input name="target" value="https://roytang.net/2019/07/upgrading-a-react-native-project/" type="hidden" />
        <input name="source" placeholder="Your reply URL" style="width:90%" required />
        <button type="submit" >Submit</button>
    </form>
</li>

<li>Or you can just <a href="https://roytang.net/about/contact">contact me</a>!</li>
</ul>
</div>




<div class="navigation">
  

    
    <a class="prev" href="https://roytang.net/2019/07/why-travel/" title="Why Travel?">
        Previous: Why Travel?
    </a>
    
    
    <a class="next" href="https://roytang.net/2019/07/a-look-back-at-the-marvel-cinematic-universe/" title="A Look Back at the Marvel Cinematic Universe">
        Next: A Look Back at the Marvel Cinematic Universe 
    </a>
    
  
</div>  




</article>

</div>
<div class="sidebar">
    <div class="menu">On This Site
    <ul>

    <li><a href="https://apps.roytang.net/blog/search">Search</a></li>

    <li><a href="https://apps.roytang.net/blog/random">Random</a></li>

    <li><a href="https://roytang.net/onthisday/">On This Day</a></li>

    <li><a href="https://roytang.net/albums/sketchbook/">Sketchbook</a></li>

    <li><a href="https://roytang.net/page/lists/reading/">Reading List</a></li>

    <li><a href="https://roytang.net/page/lists/2020/movies/">2020 Movies List</a></li>

    <li><a href="https://roytang.net/page/blogroll">Blogroll</a></li>

    <li><a href="https://roytang.net/page/stats/site/">Stats</a></li>

    <li><a href="https://roytang.net/page/about/contact">Contact</a></li>

</ul>
    </div>
    <div class="menu">Things I Write About
    <ul>

    <li><a href="https://roytang.net/tags/favorites/">Featured Posts</a></li>

    <li><a href="https://roytang.net/tags/weeknotes/">Weeknotes</a></li>

    <li><a href="https://roytang.net/tags/software-development/">Software Development</a></li>

    <li><a href="https://roytang.net/tags/mtg/">Magic the Gathering</a></li>

    <li><a href="https://roytang.net/tags/gaming/">Gaming</a></li>

    <li><a href="https://roytang.net/tags/movies/">Movies</a></li>

    <li><a href="https://roytang.net/tags/tv/">TV</a></li>

    <li><a href="https://roytang.net/tags/tech-life/">Tech Life</a></li>

    <li><a href="https://roytang.net/tags/philippines/">Philippines</a></li>

    <li><a href="https://roytang.net/tags/">View All</a></li>

</ul>
    </div>
    <div class="menu">Elsewhere
    <ul>

    <li><a href="https://twitter.com/roytang" rel="me">Twitter</a></li>

    <li><a href="https://mastodon.technology/@roytang" rel="me">Mastodon</a></li>

    <li><a href="https://twitch.tv/twitchyroy" rel="me">Twitch</a></li>

    <li><a href="https://www.linkedin.com/in/roytang" rel="me">LinkedIn</a></li>

    <li><a href="https://instagram.com/roytang0400" rel="me">Instagram</a></li>

    <li><a href="https://github.com/roytang" rel="me">Github</a></li>

    <li><a href="https://reddit.com/u/hungryroy" rel="me">Reddit</a></li>

    <li><a href="https://ko-fi.com/roytang" rel="me">Ko-fi</a></li>

</ul>
    </div>
    <div class="menu">Subscribe
    <ul>

    <li><a href="https://roytang.net/index.xml">Everything (RSS)</a></li>

    <li><a href="https://roytang.net/blog/index.xml">Blog (RSS)</a></li>

    <li><a href="https://roytang.net/notes/index.xml">Notes (RSS)</a></li>

    <li><a href="https://roytang.net/photos/index.xml">Photos (RSS)</a></li>

    <li><a href="https://roytang.net/links/index.xml">Links (RSS)</a></li>

</ul>
    </div>
</div>
</div>
<footer class="mainfooter">
    
        <p><p>Webrings:</p>
<ul>
<li><a href="https://xn--sr8hvo.ws/%F0%9F%8D%B3%F0%9F%91%AB%E2%9E%95/previous">←</a>🕸💍<a href="https://xn--sr8hvo.ws/%F0%9F%8D%B3%F0%9F%91%AB%E2%9E%95/next">→</a></li>
<li><a href='https://webring.xxiivv.com/#random' target='_blank'><img class='link' src='https://webring.xxiivv.com/icon.black.svg'/></a></li>
<li><strong>Geekring:</strong> <a href='http://geekring.net/site/91/previous'>Previous</a> :: <a href='http://geekring.net/site/91/random'>Random</a> :: <a href='http://geekring.net/site/91/next'>Next</a></li>
</ul>
</p>
    
    (c) 2002-2020 Roy Tang unless otherwise indicated.
    
    <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.</p>
    
    <p><small>Powered by <a href="https://github.com/roytang/blog/tree/master/themes/exhale">Exhale Hugo Theme</a></small>. 
        Last modified at: 2020 09 26 17:21:30.
        
        <a href='https://github.com/roytang/blog/tree/master/content/post/2019/07/react-native-mobile-devt/index.md' title='source file'>Source file</a>
        
    </p>
</footer>      


</div>
<script src="https://roytang.net/js/exhale.js"></script>
</body>
</html>

